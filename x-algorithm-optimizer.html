<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥X ç®—æ³•æ¨¡æ‹Ÿå™¨</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts for better simulation -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: #f7f9f9; 
            color: #0f1419;
        }
        /* X-like styles */
        .x-font { font-family: 'Inter', sans-serif; }
        .x-blue { color: #1d9bf0; }
        .x-bg-blue { background-color: #1d9bf0; }
        .x-border { border-color: #eff3f4; }
        
        /* Mobile Preview Frame */
        .mobile-frame {
            width: 375px;
            height: 700px;
            border-radius: 40px;
            border: 12px solid #222;
            overflow: hidden;
            position: relative;
            background: white;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 30px;
            background: #222;
            border-bottom-left-radius: 16px;
            border-bottom-right-radius: 16px;
            z-index: 20;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cfd9de; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #b9c6cc; }

        .editor-textarea {
            outline: none;
            resize: none;
            min-height: 200px;
        }

        .highlight-risk { background-color: #fee2e2; color: #991b1b; padding: 0 2px; border-radius: 2px; }
        .highlight-good { background-color: #dcfce7; color: #166534; padding: 0 2px; border-radius: 2px; }
        
        /* Animation */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fadeInUp 0.3s ease-out; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">
    
    <div id="app" class="flex-1 flex flex-col md:flex-row h-full">
        
        <!-- Left: Editor & Tools -->
        <div class="flex-1 flex flex-col h-full bg-white border-r border-slate-200 overflow-y-auto">
            
            <!-- Header -->
            <header class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-white/80 backdrop-blur sticky top-0 z-10">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center overflow-hidden">
                        <img src="x.png" alt="Logo" class="w-full h-full object-cover">
                    </div>
                    <div>
                        <h1 class="font-bold text-lg leading-tight">ğŸ”¥X ç®—æ³•æ¨¡æ‹Ÿå™¨</h1>
                        <p class="text-xs text-slate-500">
                            å¼€å‘è€…: <a href="https://x.com/AntCaveClub" target="_blank" class="text-blue-500 hover:underline">@AntCaveClub</a> | æ¨¡æ‹Ÿä½ çš„æ¨æ–‡æ˜¯å¦ä¼šâ€œç«â€
                        </p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button @click="showManual = true" class="px-4 py-2 rounded-full font-bold text-sm bg-blue-50 text-blue-600 hover:bg-blue-100 transition-colors">
                        <i class="fa-solid fa-book-open mr-1"></i> æµé‡æ‰‹å†Œ
                    </button>
                    <button @click="showReport = true" class="px-4 py-2 rounded-full font-bold text-sm bg-purple-50 text-purple-600 hover:bg-purple-100 transition-colors">
                        <i class="fa-solid fa-chart-pie mr-1"></i> ç®—æ³•åˆ†æ
                    </button>
                     <button @click="copyContent" class="px-4 py-2 rounded-full font-bold text-sm transition-colors" 
                        :class="copied ? 'bg-green-500 text-white' : 'bg-black text-white hover:bg-slate-800'">
                        <i class="fa-solid" :class="copied ? 'fa-check' : 'fa-copy'"></i> {{ copied ? 'å·²å¤åˆ¶' : 'å¤åˆ¶å…¨æ–‡' }}
                    </button>
                </div>
            </header>

            <!-- Simulation Controls (New) -->
                <div class="bg-slate-50 border border-slate-200 rounded-xl p-4 mb-4">
                    <h3 class="font-bold text-slate-800 text-sm mb-3 flex items-center">
                        <i class="fa-solid fa-sliders mr-2"></i> è´¦å·å‚æ•°è®¾ç½®
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs text-slate-500 font-medium block mb-1">ç²‰ä¸æ•°</label>
                            <input v-model.number="userStats.followers" type="number" class="w-full text-sm px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:border-blue-400" placeholder="1000">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500 font-medium block mb-1">è´¦å·æƒé‡</label>
                            <select v-model="userStats.isVerified" class="w-full text-sm px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:border-blue-400 bg-white">
                                <option :value="false">æ™®é€šè´¦å·</option>
                                <option :value="true">Blueè®¤è¯ (2x Boost)</option>
                                <option :value="'gold'">é‡‘æ ‡è®¤è¯ (5x Boost)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Editor Area -->
                <div class="p-6 space-y-4 flex-1">
                
                <!-- Toolbar -->
                <div class="flex flex-wrap gap-2 mb-2 items-center">
                    <div class="relative group z-20">
                         <button class="px-3 py-1.5 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-full text-xs font-bold hover:shadow-lg transition-all transform hover:-translate-y-0.5">
                            <i class="fa-solid fa-fire mr-1"></i> ç—…æ¯’æ¨¡æ¿
                        </button>
                        <!-- Dropdown -->
                        <div class="absolute top-full left-0 mt-2 w-48 bg-white border border-slate-200 rounded-xl shadow-xl p-2 hidden group-hover:block">
                            <button @click="applyTemplate('contrarian')" class="w-full text-left px-3 py-2 text-xs hover:bg-slate-50 rounded-lg text-slate-700 font-medium">
                                <i class="fa-solid fa-bolt text-yellow-500 mr-2"></i>åç›´è§‰/äº‰è®®
                            </button>
                            <button @click="applyTemplate('story')" class="w-full text-left px-3 py-2 text-xs hover:bg-slate-50 rounded-lg text-slate-700 font-medium">
                                <i class="fa-solid fa-book-open text-blue-500 mr-2"></i>ä¸ªäººæ•…äº‹ (Thread)
                            </button>
                            <button @click="applyTemplate('listicle')" class="w-full text-left px-3 py-2 text-xs hover:bg-slate-50 rounded-lg text-slate-700 font-medium">
                                <i class="fa-solid fa-list-check text-green-500 mr-2"></i>å¹²è´§æ¸…å•
                            </button>
                        </div>
                    </div>

                    <div class="h-4 w-px bg-slate-300 mx-1"></div>

                    <button @click="insertHook" class="px-3 py-1.5 bg-blue-50 text-blue-600 rounded-full text-xs font-semibold hover:bg-blue-100 transition-colors">
                        <i class="fa-solid fa-magnet mr-1"></i> é»„é‡‘å¼€å¤´
                    </button>
                    <button @click="insertCTA" class="px-3 py-1.5 bg-green-50 text-green-600 rounded-full text-xs font-semibold hover:bg-green-100 transition-colors">
                        <i class="fa-solid fa-comments mr-1"></i> äº’åŠ¨è¯±é¥µ
                    </button>
                     <button @click="clearText" class="px-3 py-1.5 bg-slate-100 text-slate-600 rounded-full text-xs font-semibold hover:bg-slate-200 transition-colors ml-auto">
                        <i class="fa-solid fa-trash mr-1"></i>
                    </button>
                </div>

                <!-- Textarea -->
                <div class="relative group">
                    <textarea 
                        v-model="content" 
                        class="editor-textarea w-full text-lg p-4 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-blue-400 focus:bg-white transition-all placeholder-slate-400"
                        placeholder="åœ¨æ­¤æ’°å†™ã€‚å¦‚æœå†…å®¹è¾ƒé•¿ï¼Œå³ä¾§ä¼šè‡ªåŠ¨é¢„è§ˆä¸º Thread æ¨¡å¼..."
                        ref="textarea"
                    ></textarea>
                    
                    <!-- Character Counter -->
                    <div class="absolute bottom-4 right-4 text-xs font-medium px-2 py-1 rounded bg-white/80 backdrop-blur border border-slate-200"
                        :class="charCount > 280 ? 'text-red-500' : 'text-slate-500'">
                        {{ charCount }} / 280 (é•¿æ–‡æ¨¡å¼)
                    </div>
                </div>

                <!-- Simulation Dashboard (Replaces Score Card) -->
                <div class="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                    <div class="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                        <h3 class="font-bold text-slate-800 text-sm">æ¨¡æ‹Ÿè¿è¡Œæ§åˆ¶å°</h3>
                        <button @click="runSimulation" :disabled="isSimulating" class="px-4 py-1.5 bg-black text-white text-xs font-bold rounded-full hover:bg-slate-800 disabled:opacity-50 transition-all flex items-center">
                            <i class="fa-solid fa-play mr-1" :class="{'fa-spin': isSimulating}"></i> {{ isSimulating ? 'è®¡ç®—ä¸­...' : 'å¼€å§‹æ¨¡æ‹Ÿ' }}
                        </button>
                    </div>
                    
                    <div v-if="simulationResult" class="p-4 space-y-4">
                        <!-- Interaction Breakdown -->
                        <div class="grid grid-cols-4 gap-2 text-center mb-4">
                            <div class="bg-slate-50 p-2 rounded-lg border border-slate-100">
                                <div class="text-xs text-slate-500 mb-1"><i class="fa-regular fa-heart text-red-500"></i> Like</div>
                                <div class="font-bold text-slate-800">{{ simulationResult.stats.likes }}</div>
                            </div>
                            <div class="bg-slate-50 p-2 rounded-lg border border-slate-100">
                                <div class="text-xs text-slate-500 mb-1"><i class="fa-solid fa-retweet text-green-500"></i> RT</div>
                                <div class="font-bold text-slate-800">{{ simulationResult.stats.reposts }}</div>
                            </div>
                            <div class="bg-slate-50 p-2 rounded-lg border border-slate-100">
                                <div class="text-xs text-slate-500 mb-1"><i class="fa-regular fa-comment text-blue-500"></i> Reply</div>
                                <div class="font-bold text-slate-800">{{ simulationResult.stats.replies }}</div>
                            </div>
                            <div class="bg-slate-50 p-2 rounded-lg border border-slate-100">
                                <div class="text-xs text-slate-500 mb-1"><i class="fa-regular fa-bookmark text-yellow-500"></i> Save</div>
                                <div class="font-bold text-slate-800">{{ simulationResult.stats.bookmarks }}</div>
                            </div>
                        </div>

                        <!-- Funnel Visualization -->
                        <div class="space-y-2">
                            <div class="flex justify-between text-xs font-medium text-slate-500">
                                <span>å€™é€‰æ±  (In-Network)</span>
                                <span>{{ simulationResult.stage1_reach }} äºº</span>
                            </div>
                            <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-blue-400" style="width: 100%"></div>
                            </div>
                            
                            <div class="flex justify-between text-xs font-medium text-slate-500">
                                <span>åˆæ­¥ç­›é€‰ (Light Ranker)</span>
                                <span>{{ simulationResult.stage2_pass }}% é€šè¿‡ç‡</span>
                            </div>
                            <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-blue-500" :style="`width: ${simulationResult.stage2_pass}%`"></div>
                            </div>

                            <div class="flex justify-between text-xs font-medium text-slate-500">
                                <span>æœ€ç»ˆæ›å…‰ (For You)</span>
                                <span class="text-green-600 font-bold">{{ simulationResult.total_impressions }}</span>
                            </div>
                            <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-green-500" :style="`width: ${Math.min(100, (simulationResult.total_impressions / (userStats.followers * 10)) * 100)}%`"></div>
                            </div>
                        </div>

                        <!-- Viral Probability Badge -->
                        <div class="flex items-center justify-between bg-slate-50 p-3 rounded-lg border border-slate-100">
                            <span class="text-sm font-bold text-slate-700">çˆ†æ¬¾æ¦‚ç‡</span>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-black" :class="viralColor">{{ simulationResult.viral_prob }}%</span>
                                <i v-if="simulationResult.viral_prob > 80" class="fa-solid fa-fire text-red-500 animate-pulse"></i>
                            </div>
                        </div>

                        <!-- Logs -->
                        <div class="bg-black text-green-400 p-3 rounded-lg text-xs font-mono h-32 overflow-y-auto">
                            <div v-for="(log, i) in simulationLogs" :key="i" class="mb-1">
                                <span class="opacity-50">[{{ log.time }}]</span> {{ log.msg }}
                            </div>
                        </div>
                    </div>
                    <div v-else class="p-8 text-center text-slate-400 text-sm">
                        ç‚¹å‡»â€œå¼€å§‹æ¨¡æ‹Ÿâ€æŸ¥çœ‹ç®—æ³•é¢„æµ‹ç»“æœ
                    </div>
                </div>

                <!-- Analysis Cards (Collapsed) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 opacity-50 hover:opacity-100 transition-opacity">
                    <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
                        <h3 class="font-bold text-slate-800 text-sm mb-3 flex items-center">
                            <i class="fa-solid fa-robot mr-2 text-slate-500"></i> ç®—æ³•å¥åº·åº¦æ£€æŸ¥
                        </h3>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center justify-between">
                                <span class="text-slate-600">é’©å­å¸å¼•åŠ› (å‰50å­—)</span>
                                <span :class="hookScoreColor" class="font-bold">{{ hookScoreText }}</span>
                            </li>
                            <li class="flex items-center justify-between">
                                <span class="text-slate-600">å¯è¯»æ€§ (åˆ†æ®µ/ç©ºè¡Œ)</span>
                                <span :class="readabilityColor" class="font-bold">{{ readabilityText }}</span>
                            </li>
                            <li class="flex items-center justify-between">
                                <span class="text-slate-600">äº’åŠ¨è¯±é¥µ (ç–‘é—®/å¼•å¯¼)</span>
                                <span :class="ctaScore > 0 ? 'text-green-600' : 'text-slate-400'" class="font-bold">
                                    <i v-if="ctaScore > 0" class="fa-solid fa-check"></i>
                                    <span v-else>æœªæ£€æµ‹åˆ°</span>
                                </span>
                            </li>
                            <li class="flex items-center justify-between">
                                <span class="text-slate-600">æƒ…ç»ªå”¤èµ· (Power Words)</span>
                                <span :class="hasEmotion ? 'text-green-600' : 'text-slate-400'" class="font-bold">
                                    <i v-if="hasEmotion" class="fa-solid fa-fire"></i>
                                    <span v-else>å¹³æ·¡</span>
                                </span>
                            </li>
                             <li class="flex items-center justify-between">
                                <span class="text-slate-600">é£é™©è¯æ£€æµ‹</span>
                                <span :class="riskWords.length > 0 ? 'text-red-500' : 'text-green-500'" class="font-bold">
                                    {{ riskWords.length > 0 ? riskWords.length + ' ä¸ªé£é™©è¯' : 'å®‰å…¨' }}
                                </span>
                            </li>
                        </ul>
                    </div>

                    <!-- Actionable Tips -->
                    <div class="bg-blue-50 border border-blue-100 rounded-xl p-4 shadow-sm">
                        <h3 class="font-bold text-blue-800 text-sm mb-3 flex items-center">
                            <i class="fa-solid fa-wand-magic-sparkles mr-2"></i> ä¼˜åŒ–å»ºè®®
                        </h3>
                        <ul class="space-y-2 text-xs text-blue-900">
                            <li v-if="!hasHook" class="flex items-start">
                                <i class="fa-solid fa-circle-exclamation mt-1 mr-2 opacity-70"></i>
                                å¼€å¤´å¤ªå¹³æ·¡ã€‚å°è¯•åŠ å…¥æ•°å­—ã€ç–‘é—®æˆ–å¼ºçƒˆè§‚ç‚¹ï¼Œé˜²æ­¢è¢«æ»‘èµ°ã€‚
                            </li>
                             <li v-if="isLongBlock" class="flex items-start">
                                <i class="fa-solid fa-align-justify mt-1 mr-2 opacity-70"></i>
                                æ®µè½è¿‡é•¿ï¼Œç”¨æˆ·åœç•™æ—¶é—´(Dwell Time)å¯èƒ½å˜çŸ­ã€‚å»ºè®®å¤šåˆ†æ®µï¼Œå¢åŠ ç©ºè¡Œã€‚
                            </li>
                            <li v-if="!hasCTA" class="flex items-start">
                                <i class="fa-solid fa-comment-dots mt-1 mr-2 opacity-70"></i>
                                ç¼ºå°‘äº’åŠ¨å¼•å¯¼ã€‚Reply æƒé‡æé«˜ï¼Œå»ºè®®åœ¨ç»“å°¾æä¸€ä¸ªé—®é¢˜ã€‚
                            </li>
                            <li v-if="hasLinkInMain" class="flex items-start">
                                <i class="fa-solid fa-link mt-1 mr-2 opacity-70"></i>
                                æ­£æ–‡åŒ…å«é“¾æ¥å¯èƒ½ä¼šé™æƒã€‚å»ºè®®å°†é“¾æ¥æ”¾åœ¨è¯„è®ºåŒºï¼Œæˆ–é…å›¾ã€‚
                            </li>
                            <li v-if="tips.length === 0" class="flex items-start font-medium">
                                <i class="fa-solid fa-thumbs-up mt-1 mr-2 opacity-70"></i>
                                å¾ˆæ£’ï¼è¿™æ¡æ¨æ–‡ç»“æ„çœ‹èµ·æ¥éå¸¸ä¸é”™ã€‚
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Media Simulation -->
                 <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
                    <h3 class="font-bold text-slate-800 text-sm mb-3">åª’ä½“å ä½ç¬¦ (æ¨¡æ‹Ÿé¢„è§ˆ)</h3>
                    <div class="flex gap-2">
                        <button @click="mediaType = 'none'" :class="mediaType === 'none' ? 'bg-black text-white' : 'bg-slate-100 text-slate-600'" class="px-3 py-1.5 rounded-lg text-xs font-medium transition-colors">æ— åª’ä½“</button>
                        <button @click="mediaType = 'image'" :class="mediaType === 'image' ? 'bg-black text-white' : 'bg-slate-100 text-slate-600'" class="px-3 py-1.5 rounded-lg text-xs font-medium transition-colors">å•å›¾ (Image)</button>
                        <button @click="mediaType = 'video'" :class="mediaType === 'video' ? 'bg-black text-white' : 'bg-slate-100 text-slate-600'" class="px-3 py-1.5 rounded-lg text-xs font-medium transition-colors">è§†é¢‘ (Video)</button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Right: Real-time Preview -->
        <div class="flex-1 bg-slate-100 flex flex-col items-center justify-center p-8 overflow-hidden">
            <!-- Speed up Button (Moved to right) -->
            <div class="mb-8 w-full max-w-[375px] animate-fade-in-up">
                <a href="https://t.me/XCarTeamBot" target="_blank" class="flex items-center justify-center space-x-3 w-full py-4 bg-gradient-to-r from-orange-500 via-red-500 to-purple-600 text-white rounded-xl font-black text-lg shadow-lg hover:shadow-2xl transition-all transform hover:-translate-y-1 group">
                    <i class="fa-solid fa-bolt-lightning animate-bounce text-yellow-300"></i>
                    <span class="tracking-wider">åŠ é€Ÿå¸–å­ æ›å…‰+100%</span>
                    <div class="bg-white/20 px-2 py-1 rounded text-[10px] font-bold backdrop-blur-sm group-hover:bg-white/30 transition-colors">
                        å‰å¾€ TG äº’åŠ©
                    </div>
                </a>
                <p class="text-center text-slate-400 text-xs mt-2 font-medium">
                    <i class="fa-solid fa-circle-info mr-1"></i> åŠ å…¥äº’åŠ©è½¦é˜Ÿï¼Œé€šè¿‡ç®—æ³•å†·å¯åŠ¨
                </p>
            </div>

            <div class="mobile-frame flex flex-col scale-90 md:scale-100 transition-transform">
                <div class="notch"></div>
                
                <!-- Mobile Status Bar -->
                <div class="h-12 bg-white w-full flex justify-between items-center px-6 pt-2 z-10">
                    <span class="text-xs font-bold">9:41</span>
                    <div class="flex space-x-1.5">
                        <i class="fa-solid fa-signal text-xs"></i>
                        <i class="fa-solid fa-wifi text-xs"></i>
                        <i class="fa-solid fa-battery-full text-xs"></i>
                    </div>
                </div>

                <!-- App Header -->
                <div class="h-12 bg-white/95 backdrop-blur w-full flex justify-between items-center px-4 border-b border-slate-100 z-10 sticky top-0">
                    <div class="w-8 h-8 rounded-full bg-slate-200 overflow-hidden">
                         <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" />
                    </div>
                    <i class="fa-brands fa-x-twitter text-xl"></i>
                    <i class="fa-solid fa-gear text-slate-800"></i>
                </div>

                <!-- Feed Content -->
                <div class="flex-1 bg-white overflow-y-auto pb-20">
                    
                    <!-- Thread View -->
                    <div v-if="isThreadMode">
                        <div v-for="(tweet, index) in threadTweets" :key="index" class="p-4 border-b border-slate-100 relative">
                            <!-- Thread Line (if not last) -->
                            <div v-if="index < threadTweets.length - 1" class="absolute left-[38px] top-[60px] bottom-[-20px] w-0.5 bg-slate-200 z-0"></div>
                            
                            <div class="flex space-x-3 relative z-10">
                                <div class="shrink-0">
                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=User123" alt="My Avatar" />
                                    </div>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-1 truncate">
                                            <span class="font-bold text-slate-900 text-[15px]">Creator</span>
                                            <i class="fa-solid fa-certificate text-blue-500 text-xs"></i>
                                            <span class="text-slate-500 text-[15px]">@creator</span>
                                            <span class="text-slate-500 text-[15px]">Â·</span>
                                            <span class="text-slate-500 text-[15px]">1h</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-1 text-[15px] leading-normal text-slate-900 whitespace-pre-wrap break-words">
                                        <span v-html="formatTweet(tweet)"></span>
                                    </div>

                                    <!-- Action Bar (Simplified for thread) -->
                                    <div class="flex justify-between mt-3 max-w-[300px] text-slate-500">
                                        <i class="fa-regular fa-comment text-sm"></i>
                                        <i class="fa-solid fa-retweet text-sm"></i>
                                        <i class="fa-regular fa-heart text-sm"></i>
                                        <i class="fa-solid fa-chart-simple text-sm"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Single Post View -->
                    <div v-else class="p-4 border-b border-slate-100">
                        <div class="flex space-x-3">
                            <div class="shrink-0">
                                <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=User123" alt="My Avatar" />
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-1 truncate">
                                        <span class="font-bold text-slate-900 text-[15px]">Creator</span>
                                        <i class="fa-solid fa-certificate text-blue-500 text-xs"></i>
                                        <span class="text-slate-500 text-[15px]">@creator</span>
                                        <span class="text-slate-500 text-[15px]">Â·</span>
                                        <span class="text-slate-500 text-[15px]">1h</span>
                                    </div>
                                    <i class="fa-solid fa-ellipsis text-slate-400 text-sm"></i>
                                </div>
                                
                                <!-- Tweet Body with Show More logic -->
                                <div class="mt-1 text-[15px] leading-normal text-slate-900 whitespace-pre-wrap break-words" :class="{'line-clamp-5': !expanded && needsFold}">
                                    <span v-html="formattedContent"></span>
                                </div>
                                <button v-if="!expanded && needsFold" @click="expanded = true" class="text-blue-500 text-[15px] hover:underline mt-1">Show more</button>

                                <!-- Media Placeholder -->
                                <div v-if="mediaType !== 'none'" class="mt-3 rounded-2xl overflow-hidden border border-slate-200 bg-slate-100 relative" 
                                     :class="mediaType === 'video' ? 'aspect-video' : 'aspect-[4/3]'">
                                    
                                    <img v-if="mediaType === 'image'" src="https://picsum.photos/seed/picsum/600/400" class="w-full h-full object-cover" />
                                    
                                    <div v-if="mediaType === 'video'" class="w-full h-full flex items-center justify-center bg-black">
                                        <div class="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center text-white pl-1">
                                            <i class="fa-solid fa-play"></i>
                                        </div>
                                        <div class="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-1.5 py-0.5 rounded">0:45</div>
                                    </div>
                                </div>

                                <!-- Action Bar -->
                                <div class="flex justify-between mt-3 max-w-[300px] text-slate-500">
                                    <div class="group flex items-center space-x-1 cursor-pointer hover:text-blue-500">
                                        <div class="p-2 -ml-2 rounded-full group-hover:bg-blue-50 transition-colors">
                                            <i class="fa-regular fa-comment text-lg"></i>
                                        </div>
                                        <span class="text-xs">24</span>
                                    </div>
                                    <div class="group flex items-center space-x-1 cursor-pointer hover:text-green-500">
                                        <div class="p-2 -ml-2 rounded-full group-hover:bg-green-50 transition-colors">
                                            <i class="fa-solid fa-retweet text-lg"></i>
                                        </div>
                                        <span class="text-xs">5</span>
                                    </div>
                                    <div class="group flex items-center space-x-1 cursor-pointer hover:text-pink-500">
                                        <div class="p-2 -ml-2 rounded-full group-hover:bg-pink-50 transition-colors">
                                            <i class="fa-regular fa-heart text-lg"></i>
                                        </div>
                                        <span class="text-xs">128</span>
                                    </div>
                                    <div class="group flex items-center space-x-1 cursor-pointer hover:text-blue-500">
                                        <div class="p-2 -ml-2 rounded-full group-hover:bg-blue-50 transition-colors">
                                            <i class="fa-solid fa-chart-simple text-lg"></i>
                                        </div>
                                        <span class="text-xs">2.4K</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dummy Next Post -->
                     <div class="p-4 border-b border-slate-100 opacity-50">
                        <div class="flex space-x-3">
                            <div class="w-10 h-10 rounded-full bg-slate-200"></div>
                            <div class="flex-1 space-y-2">
                                <div class="h-4 bg-slate-200 rounded w-1/3"></div>
                                <div class="h-16 bg-slate-200 rounded w-full"></div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Bottom Nav -->
                <div class="h-14 bg-white border-t border-slate-200 flex justify-around items-center absolute bottom-0 w-full">
                    <i class="fa-solid fa-house text-xl text-black"></i>
                    <i class="fa-solid fa-magnifying-glass text-xl text-slate-400"></i>
                    <i class="fa-regular fa-bell text-xl text-slate-400"></i>
                    <i class="fa-regular fa-envelope text-xl text-slate-400"></i>
                </div>
            </div>
        </div>

    <!-- Manual Modal -->
        <div v-if="showManual" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-4xl h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-fade-in-up">
                <div class="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <h2 class="font-bold text-xl text-slate-800"><i class="fa-solid fa-book-open mr-2 text-blue-500"></i>æµé‡å¢é•¿æ‰‹å†Œ</h2>
                    <button @click="showManual = false" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300 flex items-center justify-center transition-colors text-slate-500">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-8 prose prose-slate max-w-none text-slate-700 leading-relaxed">
                    <h1 class="text-2xl font-bold mb-4 text-slate-900">X æµé‡å¢é•¿æ‰‹å†Œï¼ˆäººäººéƒ½èƒ½çœ‹æ‡‚ç‰ˆï¼‰</h1>
                    <p class="text-slate-500 mb-8 text-lg border-l-4 border-blue-500 pl-4 bg-blue-50 py-2 rounded-r">æŠŠç®—æ³•æƒ³æˆä¸€ä¸ªâ€œè¶…å¿«çš„ç¼–è¾‘éƒ¨â€ï¼Œå¢é•¿ä¸æ˜¯éª—ç®—æ³•ï¼Œè€Œæ˜¯è®©å†…å®¹æ›´å®¹æ˜“è¢«æ‰¾åˆ°ã€æ‰“é«˜åˆ†ã€ä¸è¿‡æ»¤ã€‚</p>

                    <h3 class="text-xl font-bold mt-8 mb-4 flex items-center"><span class="bg-black text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2">1</span> ç®—æ³•åˆ°åº•åœ¨ç®—ä»€ä¹ˆï¼Ÿ</h3>
                    <p class="mb-4">å®ƒåœ¨ç®—ä½ â€œä¼šä¸ä¼šè¡ŒåŠ¨â€ã€‚æ­£å‘åŠ¨ä½œï¼ˆç‚¹èµã€å›å¤ã€è½¬å‘ã€åœç•™ï¼‰åŠ åˆ†ï¼Œè´Ÿå‘åŠ¨ä½œï¼ˆæ‹‰é»‘ã€ä¸¾æŠ¥ã€ä¸æ„Ÿå…´è¶£ï¼‰å‡åˆ†ã€‚å¢é•¿æœ¬è´¨æ˜¯ï¼š<strong>æé«˜æ­£å‘æ¦‚ç‡ï¼Œé™ä½è´Ÿå‘æ¦‚ç‡</strong>ã€‚</p>

                    <h3 class="text-xl font-bold mt-8 mb-4 flex items-center"><span class="bg-black text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2">2</span> ä¸‰é“å…³å¡</h3>
                    <ul class="list-disc pl-5 space-y-2 mb-4">
                        <li><strong>å¬å›ï¼ˆæ‰¾ç¨¿å­ï¼‰</strong>ï¼šç½‘ç»œå†…ï¼ˆç†Ÿäººï¼‰+ ç½‘ç»œå¤–ï¼ˆé™Œç”Ÿäººï¼‰ã€‚æƒ³çˆ†å¿…é¡»åšç½‘ç»œå¤–å¬å›ï¼ˆä¸»é¢˜æ¸…æ™°ï¼‰ã€‚</li>
                        <li><strong>æ’åºï¼ˆæ‰“åˆ†ï¼‰</strong>ï¼šå›å¤ã€è½¬å‘ã€åœç•™æƒé‡æœ€é«˜ã€‚</li>
                        <li><strong>è¿‡æ»¤ï¼ˆè¿‡å®¡ï¼‰</strong>ï¼šå»é‡ã€æ‹‰é»‘ã€è¿è§„ç›´æ¥ä¸¢æ‰ã€‚</li>
                    </ul>

                    <h3 class="text-xl font-bold mt-8 mb-4 flex items-center"><span class="bg-black text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2">3</span> å¢é•¿åŸåˆ™</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                            <strong class="text-slate-900 block mb-1">åŸåˆ™1ï¼šä¸»é¢˜è¦çª„ï¼Œè¡¨è¾¾è¦æ¸…</strong>
                            <span class="text-sm">åƒä¹¦çš„ç›®å½•ä¸€æ ·æ¸…æ™°ã€‚</span>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                            <strong class="text-slate-900 block mb-1">åŸåˆ™2ï¼šç»™ç†ç”±è®©ç”¨æˆ·äº’åŠ¨</strong>
                            <span class="text-sm">ä¸è¦â€œæ±‚èµâ€ï¼Œè¦â€œé‚€è¯·è¡¥å……â€æˆ–â€œå¼•å‘å…±é¸£â€ã€‚</span>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                            <strong class="text-slate-900 block mb-1">åŸåˆ™3ï¼šå…ˆç½‘ç»œå†…ï¼Œå†ç½‘ç»œå¤–</strong>
                            <span class="text-sm">å…ˆåœ¨ç†Ÿäººåœˆè·‘é€šäº’åŠ¨æ•°æ®ã€‚</span>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                            <strong class="text-slate-900 block mb-1">åŸåˆ™4ï¼šåº•çº¿æ˜¯é¿å…è´Ÿåé¦ˆ</strong>
                            <span class="text-sm">æ ‡é¢˜å…šã€è¯±å¯¼ã€äº‰è®®æ— è¾¹ç•Œä¼šç›´æ¥æ¯å·ã€‚</span>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-8 mb-4 flex items-center"><span class="bg-black text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2">4</span> 30å¤©å¢é•¿è®¡åˆ’</h3>
                    <div class="bg-green-50 p-6 rounded-xl border border-green-100 text-green-800 space-y-2">
                        <p><strong>ğŸ“… ç¬¬1-7å¤©</strong>ï¼šå®šè¶³å¤Ÿçª„çš„ä¸»é¢˜ï¼Œæ¯å¤©1æ¡ç»ƒæ‰‹æ„Ÿã€‚</p>
                        <p><strong>ğŸ“… ç¬¬8-14å¤©</strong>ï¼šæ¯å¤©æ‰¾10ä¸ªåŒä¸»é¢˜çš„äººçœŸè¯šäº’åŠ¨ã€‚</p>
                        <p><strong>ğŸ“… ç¬¬15-21å¤©</strong>ï¼šåš2-3æ¡æ¸…å•/æ•™ç¨‹/å¤ç›˜è´´ï¼Œäº‰å–è¢«è½¬å‘ã€‚</p>
                        <p><strong>ğŸ“… ç¬¬22-30å¤©</strong>ï¼šåšA/Bæµ‹è¯•ï¼Œä¼˜åŒ–æ ‡é¢˜å’Œç»“æ„ã€‚</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Modal -->
        <div v-if="showReport" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-4xl h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-fade-in-up">
                <div class="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <h2 class="font-bold text-xl text-slate-800"><i class="fa-solid fa-chart-pie mr-2 text-purple-500"></i>æ¶æ„åˆ†ææŠ¥å‘Š</h2>
                    <button @click="showReport = false" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300 flex items-center justify-center transition-colors text-slate-500">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-8 prose prose-slate max-w-none text-slate-700 leading-relaxed">
                    <h1 class="text-2xl font-bold mb-4 text-slate-900">X æ¶æ„åˆ†ææŠ¥å‘Šï¼ˆç«¯åˆ°ç«¯ï¼‰</h1>
                    <p class="text-slate-500 mb-8 text-lg border-l-4 border-purple-500 pl-4 bg-purple-50 py-2 rounded-r">åŸºäº GitHub æºç åˆ†æçš„æ¨èç³»ç»Ÿå…¨é“¾è·¯æ‹†è§£ã€‚</p>

                    <h3 class="text-xl font-bold mt-8 mb-4">1. æ¶æ„æ€»è§ˆ</h3>
                    <div class="bg-slate-800 text-slate-200 p-4 rounded-xl font-mono text-sm mb-4 overflow-x-auto">
                        æŸ¥è¯¢è¡¥å…¨ â†’ å¤šæºå¬å› (Thunder/Phoenix) â†’ å€™é€‰è¡¥å…¨ â†’ è§„åˆ™è¿‡æ»¤ â†’ æœºå™¨å­¦ä¹ æ‰“åˆ† (Phoenix/Weighted) â†’ å¤šæ ·æ€§/OONè°ƒæ•´ â†’ æœ€ç»ˆé€‰æ‹©
                    </div>

                    <h3 class="text-xl font-bold mt-8 mb-4">2. æ ¸å¿ƒæœºåˆ¶</h3>
                    <ul class="list-disc pl-5 space-y-2 mb-4">
                        <li><strong>å¤šæºå¬å›</strong>ï¼šåŒæ—¶ä»å…³æ³¨ç½‘ç»œï¼ˆThunderï¼‰å’Œå…¨ç½‘å‘é‡æ£€ç´¢ï¼ˆPhoenix Retrievalï¼‰è·å–å€™é€‰ã€‚</li>
                        <li><strong>å€™é€‰éš”ç¦»</strong>ï¼šæ‰“åˆ†æ—¶æ¯æ¡æ¨æ–‡ç‹¬ç«‹è®¡ç®—ï¼Œäº’ä¸å½±å“ï¼Œä¿è¯ç¨³å®šæ€§ã€‚</li>
                        <li><strong>å¤šç›®æ ‡é¢„æµ‹</strong>ï¼šé¢„æµ‹ Like, Reply, Repost ç­‰ 10+ ç§è¡Œä¸ºæ¦‚ç‡ï¼Œå†åŠ æƒåˆæˆã€‚</li>
                    </ul>

                    <h3 class="text-xl font-bold mt-8 mb-4">3. ç”¨æˆ·å½±å“åˆ†æ</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-slate-200 mt-2 text-sm rounded-lg overflow-hidden">
                            <tr class="bg-slate-100 text-left">
                                <th class="border border-slate-200 p-3">ç”¨æˆ·ç±»å‹</th>
                                <th class="border border-slate-200 p-3">å…³é”®å½±å“</th>
                            </tr>
                            <tr>
                                <td class="border border-slate-200 p-3 font-bold">æ–°ç”¨æˆ·</td>
                                <td class="border border-slate-200 p-3">ä¾èµ– Query Hydration çš„åœ°åŸŸ/è¯­è¨€ä¿¡å·ï¼Œæ¨èè¾ƒæ³›ã€‚å»ºè®®å¤šäº’åŠ¨åŠ é€Ÿç”»åƒæ”¶æ•›ã€‚</td>
                            </tr>
                            <tr>
                                <td class="border border-slate-200 p-3 font-bold">é‡åº¦äº’åŠ¨è€…</td>
                                <td class="border border-slate-200 p-3">ä¿¡å·ä¸°å¯Œï¼Œä¸ªæ€§åŒ–æå¼ºã€‚å®¹æ˜“é™·å…¥â€œä¿¡æ¯èŒ§æˆ¿â€ï¼Œéœ€è¦å¤šæ ·æ€§ç­–ç•¥å¹²é¢„ã€‚</td>
                            </tr>
                            <tr>
                                <td class="border border-slate-200 p-3 font-bold">åªçœ‹ä¸åŠ¨è€…</td>
                                <td class="border border-slate-200 p-3">ä¸»è¦é  Dwell/Click ä¿¡å·ã€‚å¦‚æœç®—æ³•æƒé‡åå‘æ˜¾å¼äº’åŠ¨ï¼Œä½“éªŒä¼šå˜å·®ã€‚</td>
                            </tr>
                        </table>
                    </div>

                    <h3 class="text-xl font-bold mt-8 mb-4">4. ä¸ºä»€ä¹ˆæ—§æ–¹å¼ä¸è¡Œäº†ï¼Ÿ</h3>
                    <p class="mb-4">æ—§çš„â€œæ—¶é—´çº¿+ç®€å•è§„åˆ™â€æ— æ³•åº”å¯¹<strong>ä¾›ç»™çˆ†ç‚¸</strong>ï¼ˆå†…å®¹å¤ªå¤šï¼‰ã€<strong>å¤šç›®æ ‡å†²çª</strong>ï¼ˆæ—¢è¦ç•™å­˜åˆè¦å•†ä¸šåŒ–ï¼‰å’Œ<strong>å¯¹æŠ—æ€§</strong>ï¼ˆåƒåœ¾å†…å®¹ï¼‰ã€‚ç°åœ¨çš„â€œä¸¤é˜¶æ®µ+Transformerâ€æ˜¯å”¯ä¸€è§£ã€‚</p>
                </div>
            </div>
        </div>

    </div>
    <script>
        const { createApp, ref, computed, watch } = Vue;

        createApp({
            setup() {
                const content = ref('');
                const mediaType = ref('none'); // none, image, video
                const expanded = ref(false);
                const copied = ref(false);
                const textarea = ref(null);
                
                // Simulation State
                const showManual = ref(false);
                const showReport = ref(false);
                const isSimulating = ref(false);
                const simulationResult = ref(null);
                const simulationLogs = ref([]);
                const userStats = ref({
                    followers: 1000,
                    isVerified: false
                });

                // --- ç®—æ³•è§„åˆ™åº“ (æ¨¡æ‹Ÿåç«¯é€»è¾‘) ---
                const riskWordsList = ['hack', 'buy followers', 'crypto scam', 'giveaway', 'free money', 'dm for', 'check bio'];
                // ä¼˜åŒ– Hook æ­£åˆ™ï¼Œé¿å…çº¯æ•°å­—è¢«è¯¯åˆ¤
                const hookPatterns = [/^\d+[.ã€)ï¼‰]/, /^\d+ä¸ª/, /[?!ï¼Ÿï¼]$/, /^(å¦‚ä½•|ä¸ºä»€ä¹ˆ|æ³¨æ„|è­¦å‘Š|æ­ç§˜|å®æ“|åœæ­¢|è¿™é‡Œ|å¦‚æœ)/];
                const ctaPatterns = [/(è¯„è®º|å‘Šè¯‰|è§‰å¾—|ç‚¹èµ|è½¬æ¨|æ”¶è—|RT|reply|thoughts|agree)/i, /[?ï¼Ÿ]$/];
                const emotionPatterns = [/(shocking|insane|dead|secret|illegal|warning|hate|love|obsessed|never|always|worst|best|disaster|game-changer|unbelievable|crazy|stop|don't|mistake|wrong|right|truth|lie)/i];

                // --- è®¡ç®—å±æ€§ ---
                const charCount = computed(() => content.value.length);
                const lines = computed(() => content.value.split('\n'));
                
                // æ¨¡æ‹Ÿ Show more é€»è¾‘: è¶…è¿‡ 280 å­—ç¬¦ æˆ–è€… è¶…è¿‡ 5 è¡Œ
                const needsFold = computed(() => {
                    return charCount.value > 280 || lines.value.length > 5;
                });

                // æ ¼å¼åŒ–å†…å®¹ï¼ˆé«˜äº®ï¼‰
                const formattedContent = computed(() => {
                    let text = content.value;
                    // è½¬ä¹‰ HTML
                    text = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    
                    // é«˜äº® Hashtags
                    text = text.replace(/(#\w+)/g, '<span class="text-blue-500 hover:underline cursor-pointer">$1</span>');
                    // é«˜äº® Mentions
                    text = text.replace(/(@\w+)/g, '<span class="text-blue-500 hover:underline cursor-pointer">$1</span>');
                    // é«˜äº® Links
                    text = text.replace(/(https?:\/\/[^\s]+)/g, '<span class="text-blue-500 hover:underline cursor-pointer">$1</span>');
                    
                    // é«˜äº®é£é™©è¯
                    riskWordsList.forEach(word => {
                        const reg = new RegExp(`(${word})`, 'gi');
                        text = text.replace(reg, '<span class="highlight-risk">$1</span>');
                    });

                    return text;
                });

                // åˆ†æé€»è¾‘
                const riskWords = computed(() => {
                    return riskWordsList.filter(word => content.value.toLowerCase().includes(word));
                });

                // Hook åˆ†æ (å–å‰ 50 å­—ç¬¦)
                const hasHook = computed(() => {
                    const first50 = content.value.slice(0, 50).trim();
                    if (first50.length === 0) return false;
                    return hookPatterns.some(p => p.test(first50));
                });

                const hookScoreText = computed(() => {
                    if (content.value.length === 0) return 'å¾…æ£€æµ‹';
                    if (hasHook.value) return 'å¼ºåŠ›';
                    return 'è¾ƒå¼±';
                });
                const hookScoreColor = computed(() => {
                    if (content.value.length === 0) return 'text-slate-400';
                    return hasHook.value ? 'text-green-600' : 'text-orange-500';
                });

                // å¯è¯»æ€§åˆ†æ
                const isLongBlock = computed(() => {
                    // å¦‚æœæœ‰ä»»æ„ä¸€æ®µè¶…è¿‡ 150 å­—ç¬¦æ²¡æœ‰æ¢è¡Œï¼Œè§†ä¸ºé•¿æ®µè½
                    return lines.value.some(line => line.length > 150);
                });
                const readabilityText = computed(() => {
                    if (content.value.length === 0) return 'å¾…æ£€æµ‹';
                    if (isLongBlock.value) return 'å¯†é›†';
                    if (lines.value.length > 1) return 'è‰¯å¥½';
                    return 'ä¸€èˆ¬';
                });
                const readabilityColor = computed(() => {
                    if (content.value.length === 0) return 'text-slate-400';
                    if (isLongBlock.value) return 'text-red-500';
                    return 'text-green-600';
                });

                // CTA åˆ†æ
                const hasCTA = computed(() => {
                    const lastPart = content.value.slice(-100); // æ£€æŸ¥æœ€å100å­—
                    return ctaPatterns.some(p => p.test(lastPart));
                });
                const ctaScore = computed(() => hasCTA.value ? 1 : 0);

                const hasLinkInMain = computed(() => /https?:\/\//.test(content.value));
                
                const hasEmotion = computed(() => {
                    return emotionPatterns.some(p => p.test(content.value));
                });

                // Thread Logic
                const isThreadMode = computed(() => {
                    // å¦‚æœæœ‰ '===' åˆ†éš”ç¬¦ï¼Œæˆ–è€…æ˜¯é•¿æ–‡ä¸”æœ‰å¤šæ®µè½
                    if (content.value.includes('===')) return true;
                    if (content.value.length > 280 && content.value.split('\n\n').length > 2) return true;
                    return false;
                });

                const threadTweets = computed(() => {
                    if (content.value.includes('===')) {
                        return content.value.split('===').map(t => t.trim()).filter(t => t);
                    }
                    // è‡ªåŠ¨åˆ†å‰²é•¿æ–‡ï¼šæŒ‰åŒæ¢è¡Œåˆ†å‰²ï¼Œä½†æ¯æ®µå°½é‡å‡‘å¤Ÿ 200 å­—
                    const paragraphs = content.value.split('\n\n');
                    let tweets = [];
                    let currentTweet = '';
                    
                    paragraphs.forEach(p => {
                        if ((currentTweet + '\n\n' + p).length < 280) {
                            currentTweet += (currentTweet ? '\n\n' : '') + p;
                        } else {
                            if (currentTweet) tweets.push(currentTweet);
                            currentTweet = p;
                        }
                    });
                    if (currentTweet) tweets.push(currentTweet);
                    
                    // å¦‚æœè‡ªåŠ¨åˆ†å‰²å¤±è´¥ï¼ˆåªæœ‰ä¸€æ®µï¼‰ï¼Œå¼ºè¡Œåˆ‡åˆ†æˆ–ä¿ç•™
                    if (tweets.length === 0 && content.value) tweets.push(content.value);
                    
                    return tweets;
                });

                const formatTweet = (rawText) => {
                     let text = rawText;
                    text = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    text = text.replace(/(#\w+)/g, '<span class="text-blue-500 hover:underline cursor-pointer">$1</span>');
                    text = text.replace(/(@\w+)/g, '<span class="text-blue-500 hover:underline cursor-pointer">$1</span>');
                    text = text.replace(/(https?:\/\/[^\s]+)/g, '<span class="text-blue-500 hover:underline cursor-pointer">$1</span>');
                     riskWordsList.forEach(word => {
                        const reg = new RegExp(`(${word})`, 'gi');
                        text = text.replace(reg, '<span class="highlight-risk">$1</span>');
                    });
                    return text;
                };

                // --- ç»¼åˆè¯„åˆ†é€»è¾‘ ---
                const totalScore = computed(() => {
                    if (content.value.length === 0) return 0;
                    
                    let score = 60; // åŸºç¡€åˆ†
                    
                    // Hook (20åˆ†)
                    if (hasHook.value) score += 20;
                    
                    // å¯è¯»æ€§ (10åˆ†)
                    if (!isLongBlock.value && lines.value.length > 1) score += 10;
                    
                    // CTA (10åˆ†)
                    if (hasCTA.value) score += 10;
                    
                    // æƒ…ç»ªå”¤èµ· (10åˆ†)
                    if (hasEmotion.value) score += 10;

                    // æ‰£åˆ†é¡¹
                    // é£é™©è¯ (æ¯ä¸ªæ‰£10åˆ†)
                    score -= riskWords.value.length * 10;
                    
                    // æ­£æ–‡é“¾æ¥ (æ‰£10åˆ†)
                    if (hasLinkInMain.value) score -= 10;
                    
                    return Math.max(0, Math.min(100, score));
                });

                const scoreColor = computed(() => {
                    if (totalScore.value >= 80) return 'text-green-500';
                    if (totalScore.value >= 60) return 'text-orange-500';
                    return 'text-red-500';
                });
                
                const scoreRingColor = computed(() => {
                     if (totalScore.value >= 80) return 'stroke-green-500';
                    if (totalScore.value >= 60) return 'stroke-orange-500';
                    return 'stroke-red-500';
                });

                const viralColor = computed(() => {
                    if (!simulationResult.value) return '';
                    const prob = simulationResult.value.viral_prob;
                    if (prob >= 80) return 'text-red-500';
                    if (prob >= 50) return 'text-green-500';
                    return 'text-slate-500';
                });

                // å»ºè®®åˆ—è¡¨
                const tips = computed(() => {
                    const t = [];
                    if (!hasHook.value && content.value.length > 0) t.push('hook');
                    if (isLongBlock.value) t.push('format');
                    if (!hasCTA.value && content.value.length > 0) t.push('cta');
                    if (hasLinkInMain.value) t.push('link');
                    return t;
                });

                // --- Simulation Logic ---
                const addLog = (msg) => {
                    simulationLogs.value.unshift({
                        time: new Date().toLocaleTimeString().split(' ')[0],
                        msg
                    });
                };

                const runSimulation = async () => {
                    if (content.value.length === 0) {
                        alert('è¯·å…ˆè¾“å…¥å†…å®¹');
                        return;
                    }

                    isSimulating.value = true;
                    simulationResult.value = null;
                    simulationLogs.value = [];

                    addLog('Initializing candidate pipeline...');
                    
                    // 1. Define Base Action Probabilities (Generic User Behavior)
                    // Like is easiest, Bookmark is rare, Reply is high effort
                    let p_like = 0.008;      // 0.8% base like rate
                    let p_repost = 0.001;    // 0.1% base repost rate
                    let p_reply = 0.0005;    // 0.05% base reply rate
                    let p_bookmark = 0.0003; // 0.03% base bookmark rate
                    
                    // --- Content Modifiers ---
                    
                    // Hook -> Increases Dwell Time -> Increases all probs slightly
                    if (hasHook.value) {
                        p_like *= 1.5;
                        p_repost *= 1.2;
                        p_reply *= 1.2;
                        p_bookmark *= 1.5; // Good hook often implies value
                    }

                    // CTA -> Increases specific action strongly
                    if (hasCTA.value) {
                        const textLower = content.value.toLowerCase();
                        if (textLower.match(/(comment|reply|thoughts|tell|è¯„è®º|å‘Šè¯‰|è§‰å¾—)/i)) p_reply *= 3.0;
                        if (textLower.match(/(rt|repost|share|spread|è½¬æ¨|è½¬å‘)/i)) p_repost *= 3.0;
                        if (textLower.match(/(save|bookmark|æ”¶è—|é©¬)/i)) p_bookmark *= 3.0;
                        if (textLower.match(/(like|agree|ç‚¹èµ)/i)) p_like *= 2.0;
                        // Generic CTA boost if specific keyword not found but pattern matched
                        p_reply *= 1.2; 
                    }

                    // Emotion -> Increases Reply and Repost (Reactionary)
                    if (hasEmotion.value) {
                        p_reply *= 1.5;
                        p_repost *= 1.5;
                        p_like *= 1.2;
                    }

                    // Media -> Increases Like and Retweet
                    if (mediaType.value !== 'none') {
                        p_like *= 2.0;
                        p_repost *= 1.5;
                        // Video specifically boosts dwell time & retention
                        if (mediaType.value === 'video') {
                             p_repost *= 1.2;
                             p_bookmark *= 1.2;
                        }
                    }

                    // Link Penalty (Algo hates leaving platform) -> Reduces Reach & Repost
                    if (hasLinkInMain.value) {
                        p_repost *= 0.5;
                        p_like *= 0.8;
                    }

                    // Readability -> Long block reduces finish rate -> reduces Like/Repost
                    if (isLongBlock.value) {
                        p_like *= 0.7;
                        p_repost *= 0.6;
                        p_reply *= 0.8;
                    }
                    
                    // Risk Words -> Zero visibility
                    if (riskWords.value.length > 0) {
                        p_like = 0; p_repost = 0; p_reply = 0; p_bookmark = 0;
                    }

                    // Short Content Penalty (Anti-Spam)
                    if (content.value.length < 5 && mediaType.value === 'none') {
                        // "GM" case: almost zero engagement unless verified (handled by user boost later)
                        p_like = 0.0001; 
                        p_repost = 0.00001;
                        p_reply = 0.0001;
                        p_bookmark = 0;
                        addLog('âš ï¸ Content too short. Interaction probabilities slashed.');
                    } else if (content.value.length < 15 && mediaType.value === 'none') {
                        p_like *= 0.5;
                        p_repost *= 0.3;
                        p_bookmark *= 0.1;
                        addLog('âš ï¸ Short content detected. Penalized.');
                    }

                    // User Boost (Verified users get better distribution -> higher effective probs)
                    let user_boost = 1.0;
                    if (userStats.value.isVerified === true) user_boost = 2.0;
                    if (userStats.value.isVerified === 'gold') user_boost = 5.0;
                    
                    // Apply boost
                    p_like *= user_boost;
                    p_repost *= user_boost;
                    p_reply *= user_boost;
                    p_bookmark *= user_boost;

                    await new Promise(r => setTimeout(r, 800));
                    addLog(`Probabilities: Like ${(p_like*100).toFixed(2)}%, RT ${(p_repost*100).toFixed(2)}%`);

                    // 2. Stage 1: In-Network Simulation
                    const followers = userStats.value.followers;
                    const initial_reach = Math.floor(followers * 0.2); // 20% active followers
                    addLog(`Stage 1: Pushed to ${initial_reach} followers`);
                    
                    await new Promise(r => setTimeout(r, 800));

                    // Monte Carlo Simulation
                    let stats = { likes: 0, reposts: 0, replies: 0, bookmarks: 0 };
                    
                    for (let i = 0; i < initial_reach; i++) {
                        if (Math.random() < p_like) stats.likes++;
                        if (Math.random() < p_repost) stats.reposts++;
                        if (Math.random() < p_reply) stats.replies++;
                        if (Math.random() < p_bookmark) stats.bookmarks++;
                    }
                    
                    addLog(`Stage 1 Results: ${stats.likes} â¤ï¸, ${stats.reposts} ğŸ”, ${stats.replies} ğŸ’¬`);

                    // 3. Weighted Score Calculation (X Algorithm weights)
                    // Reply: 54.0, Retweet: 20.0, Like: 0.5 (approx scaled down for sim)
                    // Simplified for this scale:
                    // Reply = 10 points
                    // Repost = 5 points
                    // Bookmark = 8 points (Signal for quality)
                    // Like = 1 point
                    
                    const weighted_score = (stats.likes * 1) + (stats.reposts * 5) + (stats.replies * 10) + (stats.bookmarks * 8);
                    const score_per_user = weighted_score / initial_reach; // normalized score
                    
                    addLog(`Weighted Engagement Score: ${weighted_score.toFixed(1)}`);

                    // 4. Breakout & Virality
                    let stage2_pass = 0;
                    let viral_impressions = 0;
                    
                    // Threshold: Need enough weighted signal. 
                    // E.g., 1000 users -> 200 reach.
                    // If 2 likes (2pts) -> score 2. 2/200 = 0.01. Too low.
                    // If 1 RT (5pts) + 1 Reply (10pts) + 5 Likes (5pts) -> 20pts. 20/200 = 0.1. Good.
                    
                    const breakout_threshold = 0.05; // 0.05 score per user reachable
                    
                    if (score_per_user > breakout_threshold && riskWords.value.length === 0) {
                        stage2_pass = 100;
                        addLog('ğŸš€ HIGH SIGNAL! Breaking out of network.');
                        
                        // Viral Multiplier
                        // Higher score -> Higher multiplier
                        const multiplier = Math.max(10, score_per_user * 500); // Dynamic multiplier
                        viral_impressions = Math.floor(weighted_score * multiplier * user_boost);
                        
                        addLog(`Stage 3: For You feed amplification x${multiplier.toFixed(0)}`);
                    } else {
                        stage2_pass = 10;
                        addLog('âŒ Low signal. Growth stopped.');
                        viral_impressions = Math.floor(weighted_score * 5); // Small organic ripple
                    }

                    await new Promise(r => setTimeout(r, 800));

                    const total_impressions = initial_reach + viral_impressions;
                    // Prob based on score_per_user relative to threshold
                    const viral_prob = Math.min(99, Math.floor((score_per_user / (breakout_threshold * 2)) * 100));

                    simulationResult.value = {
                        stage1_reach: initial_reach,
                        stage2_pass: stage2_pass,
                        total_impressions: total_impressions,
                        viral_prob: viral_prob,
                        stats: stats // Pass stats to UI
                    };
                    
                    addLog(`Simulation complete. Estimated Impressions: ${total_impressions}`);
                    isSimulating.value = false;
                };

                // --- æ“ä½œæ–¹æ³• ---
                const applyTemplate = (type) => {
                    let text = '';
                    if (type === 'contrarian') {
                        text = "Unpopular opinion: [æŸä¸ªæµè¡Œè§‚ç‚¹] is completely wrong.\n\nHere is why (and what to do instead):\n\n1. [åŸå› ä¸€]\n\n2. [åŸå› äºŒ]\n\n3. [åŸå› ä¸‰]\n\nIf you agree, let's debate in the comments. ğŸ‘‡";
                    } else if (type === 'story') {
                        text = "6 months ago I was [ç³Ÿç³•çŠ¶æ€].\n\nToday I am [ç†æƒ³çŠ¶æ€].\n\nHere is the exact blueprint I used (step-by-step):\n\n===\n\nStep 1: [ç¬¬ä¸€æ­¥]\n\nDetails...\n\n===\n\nStep 2: [ç¬¬äºŒæ­¥]\n\nDetails...\n\n===\n\nStep 3: [ç¬¬ä¸‰æ­¥]\n\nDetails...\n\n===\n\nSave this thread for later! ğŸ”–";
                    } else if (type === 'listicle') {
                        text = "10 tools to [è¾¾æˆç›®æ ‡] (that feel illegal to know):\n\n1. Tool A\n\n2. Tool B\n\n3. Tool C\n\n...\n\nWhich one is your favorite? ğŸ‘‡";
                    }
                    content.value = text;
                };

                const insertHook = () => {
                    const hooks = [
                        "3ä¸ªè®©ä½ ç›¸è§æ¨æ™šçš„æŠ€å·§ï¼š\n\n",
                        "ä¸ºä»€ä¹ˆå¤§å¤šæ•°äººéƒ½åšé”™äº†ï¼Ÿ\n\n",
                        "æ­ç§˜ï¼šå¦‚ä½•åœ¨30å¤©å†…å®ç°å¢é•¿ï¼Ÿ\n\n",
                        "è­¦å‘Šï¼šä¸è¦å†å¿½è§†è¿™ä¸ªé—®é¢˜äº†ï¼\n\n",
                        "æ•°æ®ä¸ä¼šè¯´è°ï¼š\n\n",
                        "Unpopular opinion: \n\n",
                        "å¦‚æœä¸è¯»è¿™æ¡ï¼Œä½ å¯èƒ½æ­£åœ¨æµªè´¹é’±ï¼š\n\n",
                        "æˆ‘èŠ±äº†5å¹´æ‰æ˜ç™½è¿™ä¸ªé“ç†ï¼š\n\n",
                        "åœæ­¢åšè¿™ä»¶å‚»äº‹ï¼š\n\n",
                        "è¿™é‡Œæœ‰ä¸€ä¸ªæ®‹é…·çš„çœŸç›¸ï¼š\n\n",
                        "å¦‚ä½•ä¸èŠ±ä¸€åˆ†é’±åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿ\n\n",
                        "è¿™æ˜¯æˆ‘ä»Šå¹´å­¦åˆ°çš„æœ€é‡è¦çš„ä¸€è¯¾ï¼š\n\n",
                        "99%çš„äººéƒ½ä¸çŸ¥é“çš„ç§˜å¯†å·¥å…·ï¼š\n\n",
                        "æƒ³çŸ¥é“é«˜æ‰‹æ˜¯æ€ä¹ˆåšåˆ°çš„å—ï¼Ÿ\n\n",
                        "åˆ«å†è¢«è¿™äº›è°è¨€éª—äº†ï¼š\n\n",
                        "ç®€å•çš„æ•°å­¦é¢˜ï¼ˆå´èƒ½æ”¹å˜ä½ çš„ç”Ÿæ´»ï¼‰ï¼š\n\n",
                        "å¦‚ä½•ç”¨1å°æ—¶å®Œæˆ1å¤©çš„å·¥ä½œï¼Ÿ\n\n",
                        "ç»™20å¤šå²å¹´è½»äººçš„3ä¸ªå»ºè®®ï¼š\n\n",
                        "åœ¨è¿™ä¸ªé¢†åŸŸï¼Œåªæœ‰è¿™ä»¶äº‹æ˜¯é‡è¦çš„ï¼š\n\n",
                        "å¦‚æœä½ åªèƒ½çœ‹ä¸€æ¡æ¨æ–‡ï¼Œè¯·çœ‹è¿™æ¡ï¼š\n\n"
                    ];
                    const randomHook = hooks[Math.floor(Math.random() * hooks.length)];
                    content.value = randomHook + content.value;
                };

                const insertCTA = () => {
                    const ctas = [
                        "\n\nä½ é‡åˆ°è¿‡è¿™ç§æƒ…å†µå—ï¼Ÿè¯„è®ºåŒºå‘Šè¯‰æˆ‘ğŸ‘‡",
                        "\n\nå¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè¯·è½¬æ¨å¸®åŠ©æ›´å¤šäººï¼â™»ï¸",
                        "\n\nåŒæ„çš„è¯·æ‰£ 1ï¼Œä¸åŒæ„è¯·æ‰£ 2 ğŸ‘‡",
                        "\n\nSave this for later! ğŸ”–",
                        "\n\nWhich one is your favorite? ğŸ‘‡",
                        "\n\nTag a friend who needs to see this! ğŸ‘¥",
                        "\n\nä½ æœ‰æ›´å¥½çš„å»ºè®®å—ï¼Ÿæ¬¢è¿è¡¥å……ï¼ğŸ‘‡",
                        "\n\nå¦‚æœæ˜¯ä½ ï¼Œä½ ä¼šæ€ä¹ˆé€‰ï¼ŸğŸ¤”",
                        "\n\nè½¬å‘è¿™æ¡ï¼Œè®©ä½ çš„Timelineå˜èªæ˜ä¸€ç‚¹ ğŸ§ ",
                        "\n\nå…³æ³¨æˆ‘ @AntCaveClub è·å–æ›´å¤šå¹²è´§ ğŸš€",
                        "\n\nç‚¹èµè¡¨ç¤ºåŒæ„ï¼Œè½¬å‘è¡¨ç¤ºå¼ºçƒˆæ”¯æŒï¼â¤ï¸",
                        "\n\nåœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„çœ‹æ³•ï¼Œæˆ‘ä¼šä¸€ä¸€å›å¤ âœï¸",
                        "\n\nåˆ«å¿˜äº†æ”¶è—ï¼Œä»¥åè‚¯å®šç”¨å¾—ä¸Š â­ï¸",
                        "\n\næŠŠè¿™ä¸ªå‘ç»™ä½ çš„è€æ¿çœ‹/åŒäº‹çœ‹ ğŸ‘€",
                        "\n\nä½ ä¸Šæ¬¡é‡åˆ°è¿™ç§äº‹æ˜¯ä»€ä¹ˆæ—¶å€™ï¼ŸğŸ‘‡",
                        "\n\næƒ³çœ‹ä¸‹ä¸€æœŸæ•™ç¨‹å—ï¼Ÿç‚¹èµå‘Šè¯‰æˆ‘ ğŸ‘",
                        "\n\nè¿˜æœ‰ä»€ä¹ˆæˆ‘æ¼æ‰çš„å—ï¼Ÿè¯·æŒ‡æ•™ ğŸ‘‡",
                        "\n\nSend this to someone who needs to hear this. ğŸ“©",
                        "\n\nDrop a 'ğŸ”¥' if you agree!",
                        "\n\nè¿™å°±å»è¯•è¯•å§ï¼Œå›æ¥å‘Šè¯‰æˆ‘ç»“æœï¼ğŸƒâ€â™‚ï¸"
                    ];
                    const randomCTA = ctas[Math.floor(Math.random() * ctas.length)];
                    content.value = content.value + randomCTA;
                };

                const clearText = () => {
                    if(confirm('ç¡®å®šæ¸…ç©ºå†…å®¹å—ï¼Ÿ')) {
                        content.value = '';
                        mediaType.value = 'none';
                    }
                };
                
                const copyContent = () => {
                    navigator.clipboard.writeText(content.value).then(() => {
                        copied.value = true;
                        setTimeout(() => copied.value = false, 2000);
                    });
                };

                // Watch content change to reset expanded state
                watch(content, () => {
                    expanded.value = false;
                });

                return {
                    content,
                    mediaType,
                    expanded,
                    needsFold,
                    formattedContent,
                    charCount,
                    riskWords,
                    hookScoreText,
                    hookScoreColor,
                    hasHook,
                    readabilityText,
                    readabilityColor,
                    isLongBlock,
                    ctaScore,
                    hasCTA,
                    hasLinkInMain,
                    tips,
                    hasEmotion,
                    applyTemplate,
                    insertHook,
                    insertCTA,
                    formatTweet,
                    isThreadMode,
                    threadTweets,
                    clearText,
                    copyContent,
                    copied,
                    textarea,
                    totalScore,
                    scoreColor,
                    scoreRingColor,
                    // New exports
                    isSimulating,
                    showManual,
                    showReport,
                    simulationResult,
                    simulationLogs,
                    userStats,
                    runSimulation,
                    viralColor
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
